---
- name: install kubectl repository
  uri:
    url: https://dl.k8s.io/release/stable.txt
    return_content: yes
  register: version
- name: Download the latest kubectl release
  uri:
    url: https://dl.k8s.io/release/{{ version.content }}/bin/linux/arm/kubectl
    dest: /home/{{ ansible_user }}
  register: kubectl
- name: Check if kubectl is installed
  shell: kubectl version --client
  register: client
  failed_when: client.rc > 1
- name: Install aptitude
  apt:
    name: aptitude
    state: latest
    update_cache: true
- name: Install required system packages
  apt:
    pkg:
      - apt-transport-https
      - ca-certificates
      - curl
      - software-properties-common
      - python3-pip
      - virtualenv
      - python3-setuptools
    state: latest
    update_cache: true
- name: Add Docker GPG apt Key
  apt_key:
    url: https://download.docker.com/linux/ubuntu/gpg
    state: present

- name: Add Docker Repository
  apt_repository:
    repo: deb https://download.docker.com/linux/ubuntu jammy stable
    state: present

- name: Update apt and install docker-ce
  apt:
    name: docker-ce
    state: latest
    update_cache: true

- name: Installing Docker
  apt:
    name: docker
    state: present

- name: Starting Docker
  become: yes
  shell: |
    sudo systemctl status docker

- name: Installing conntrack
  apt:
    name: conntrack
    state: present

- name: Installing minkube
  uri:
    url: https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64
    dest: /home/{{ ansible_user }}
  register: minikubelinuxamd64
- name: Installing minkube
  become: yes
  shell: |
    sudo install minikube-linux-amd64 /usr/local/bin/minikube
- name: Starting Minikube driver using none
  become: yes
  shell: |
    minikube start --driver=docker
